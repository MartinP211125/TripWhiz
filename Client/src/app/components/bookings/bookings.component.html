<div class="bookings-container">
  <!-- Header -->
  <header class="bookings-header">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <button class="btn btn-outline-light me-3" (click)="onBackToOffers()">
            <i class="fas fa-arrow-left me-2"></i>Back to Offers
          </button>
          <div class="header-title">
            <h1 class="mb-0">
              <i class="fas fa-calendar-check me-2"></i>My Bookings
            </h1>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="bookings-content">
    <div class="container">
      <!-- Success Message -->
      <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show mb-4" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        {{ successMessage }}
        <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Close"></button>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = ''" aria-label="Close"></button>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-section text-center py-5">
        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted">Loading your bookings...</p>
      </div>

      <!-- No Bookings State -->
      <div *ngIf="!isLoading && !hasBookings()" class="no-bookings-section text-center py-5">
        <i class="fas fa-calendar-times fa-4x text-muted mb-4"></i>
        <h3 class="text-muted mb-3">No bookings yet</h3>
        <p class="text-muted mb-4">Start exploring our amazing offers and book your next adventure!</p>
        <button class="btn btn-primary btn-lg" (click)="onBackToOffers()">
          <i class="fas fa-search me-2"></i>Browse Offers
        </button>
      </div>

      <!-- Bookings Content -->
      <div *ngIf="!isLoading && hasBookings()">
        <!-- Active Bookings -->
        <div *ngIf="getActiveBookings().length > 0" class="bookings-section mb-5">
          <div class="section-header mb-4">
            <h2 class="section-title">
              <i class="fas fa-clock me-2"></i>Active Bookings
              <span class="booking-count">{{ getActiveBookings().length }}</span>
            </h2>
            <p class="section-subtitle">Your upcoming and confirmed travel plans</p>
          </div>
          
          <div class="bookings-grid">
            <div *ngFor="let booking of getActiveBookings()" class="booking-card active-booking">
              <div class="booking-image">
                <img [src]="offerMap.get(booking.offerId)?.imageUrl" [alt]="offerMap.get(booking.offerId)?.title" class="img-fluid">
                <div class="booking-status" [class]="getStatusClass(booking.status)">
                  <i [class]="getStatusIcon(booking.status)"></i>
                  {{ getStatusText(booking.status) }}
                </div>
              </div>
              
              <div class="booking-content">
                <h3 class="booking-title">{{ offerMap.get(booking.offerId)?.title }}</h3>
                <p class="booking-description">{{ offerMap.get(booking.offerId)?.description }}</p>
                
                <div class="booking-details">
                  <div class="detail-item">
                    <i class="fas fa-users text-primary me-2"></i>
                    <span>{{ booking.numberOfPeople }} {{ booking.numberOfPeople === 1 ? 'Person' : 'People' }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="fas fa-calendar text-primary me-2"></i>
                    <span>Date {{ formatDate(offerMap.get(booking.offerId)?.fromDate) }} - {{ formatDate(offerMap.get(booking.offerId)?.toDate) }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="fas fa-dollar-sign text-primary me-2"></i>
                    <span>{{ formatPrice(booking.totalPrice) }}</span>
                  </div>
                </div>

                <div class="booking-actions">
                  <button 
                    class="btn btn-outline-primary me-2" 
                    (click)="onViewOffer(booking)">
                    <i class="fas fa-eye me-1"></i>View Offer
                  </button>
                  <button 
                    class="btn btn-outline-danger"
                    [disabled]="isCancelling && cancellingBookingId === booking.id"
                    (click)="onCancelBooking(booking)">
                    <span *ngIf="isCancelling && cancellingBookingId === booking.id" 
                          class="spinner-border spinner-border-sm me-1" role="status"></span>
                    <i *ngIf="!(isCancelling && cancellingBookingId === booking.id)" 
                       class="fas fa-times me-1"></i>
                    {{ (isCancelling && cancellingBookingId === booking.id) ? 'Cancelling...' : 'Cancel' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Past Bookings -->
        <div *ngIf="getPastBookings().length > 0" class="bookings-section">
          <div class="section-header mb-4">
            <h2 class="section-title">
              <i class="fas fa-history me-2"></i>Past Bookings
              <span class="booking-count">{{ getPastBookings().length }}</span>
            </h2>
            <p class="section-subtitle">Your previous travel experiences</p>
          </div>
          
          <div class="bookings-grid">
            <div *ngFor="let booking of getPastBookings()" class="booking-card past-booking">
              <div class="booking-image">
                <img [src]="offerMap.get(booking.offerId)?.imageUrl" [alt]="offerMap.get(booking.offerId)?.title" class="img-fluid">
                <div class="booking-status" [class]="getStatusClass(booking.status)">
                  <i [class]="getStatusIcon(booking.status)"></i>
                  {{ getStatusText(booking.status) }}
                </div>
              </div>
              
              <div class="booking-content">
                <h3 class="booking-title">{{ offerMap.get(booking.offerId)?.title }}</h3>
                <p class="booking-description">{{ offerMap.get(booking.offerId)?.description }}</p>
                
                <div class="booking-details">
                  <div class="detail-item">
                    <i class="fas fa-users text-muted me-2"></i>
                    <span>{{ booking.numberOfPeople }} {{ booking.numberOfPeople === 1 ? 'Person' : 'People' }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="fas fa-calendar text-muted me-2"></i>
                    <span>Date {{ formatDate(offerMap.get(booking.offerId)?.fromDate) }} - {{ formatDate(offerMap.get(booking.offerId)?.toDate) }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="fas fa-dollar-sign text-muted me-2"></i>
                    <span>{{ formatPrice(booking.totalPrice) }}</span>
                  </div>
                </div>

                <div class="booking-actions">
                  <button 
                    class="btn btn-outline-secondary" 
                    (click)="onViewOffer(booking)">
                    <i class="fas fa-eye me-1"></i>View Offer
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>